
#Integrating the Nexmo Verify SDK

Using the <a http="https://www.nexmo.com/product/verify/">Nexmo Verify</a> SDK, you integrate Verify functionality directly into your Android App:

1. <a href="#prereq">Prerequisites</a>
2. <a href="#config">Configure Android Studio</a>
3. <a href="#integrate">Integrate the Verify SDK</a>
4.  <a href="#gcm">GCM push integration</a>

## Prerequisites<a name="prereq"></a>

To develop with the Nexmo Verify SDK you need to:

1. Create a __Nexmo Account__. If you don't have one, register at: https://dashboard.nexmo.com/register.
2. In the Nexmo Dashboard, click *Tools* > *Verify SDK*.
3. Add your App information and click *Save*.
4. In the *My Apps* section of the page you see the:
  * An __Id__: a 25 character AlNum that identifies each App that integrates the Nexmo Verify SDK.
  * A __Shared Secret__: a 15 character AlNum generated by the system.
  You use these identifiers so your App can interact with Nexmo services.
    **Note**: these identifiers are completely separate from your Nexmo __Key__ and __Secret__. You MUST NOT embed your Nexmo Key and Secret in your App.
5. Install <a href="http://developer.android.com/tools/studio/index.html"> Android Studio</a>.
6. Clone the Nexmo Verify SDK locally from: https://github.com/Nexmo/verify-android-sdk.

##Configure Android Studio<a name="config"></a>

To use the Nexmo Verify SDK, you need to:

1. Integrate the Verify SDK library into Android Studio. To do this:
  1. In Android Studio, either open an existing project, or create a new one.
  2. In the file explorer, copy *verify-beta&lt;version>.aar* to *AndroidStudioProjects/<project name>/app/libs*.
  To check that this library is installed in your project, click *File* > *Synchronize*. You will see the library in the Project view.
2. In Android Studio, update *build.gradle (Module: app)* to include:
  ```java
  repositories {
  mavenCentral()
    flatDir {
        dirs 'libs'
     }
  }

  dependencies {
    compile fileTree(dir: 'libs', include: ['*.jar'])

  compile 'com.nexmo.sdk:verify-beta<version number>@aar'
```

##Integrate the Verify SDK<a name="integrate"></a>

You now integrate the Verify SDK into your App code:

1. Create a new Nexmo Client:
  ```java
  import com.nexmo.sdk.NexmoClient;
  import com.nexmo.sdk.core.client.ClientBuilderException;
  import com.nexmo.sdk.verify.client.VerifyClient;
  import com.nexmo.sdk.verify.event.VerifyClientListener;
  import com.nexmo.sdk.verify.event.VerifyError;

  Context context = getApplicationContext();
  try {
	NexmoClient nexmoClient = new NexmoClient.NexmoClientBuilder()
                    .context(context)
                    .applicationId(Id) //your App key
                    .sharedSecretKey(SHARED_SECRET) //your App secret
                    .build();
  } catch (ClientBuilderException e) {
	e.printStackTrace();
  }
  ```
  **Note**: For the security of your Nexmo account, you should not use your Nexmo Key or Secret in your code.
2. Instantiate a new *VerifyClient* to do the verification magic.
  ```java
  verifyClient = new VerifyClient(nexmoClient);
  ```
3. Register a *Listener*. This is so your UI interacts with user events:
  ```java
  verifyClient.addVerifyListener(new VerifyClientListener() {
        @Override
        public void onVerifyInProgress(final VerifyClient verifyClient) {
        }

        @Override
        public void onUserVerified(final VerifyClient verifyClient) {
        }

        @Override
        public void onError(final VerifyClient verifyClient, final com.nexmo.sdk.verify.event.VerifyError errorCode) {
        }

        @Override
        public void onException(final IOException exception) {
        }
    });
  ```
4. Instantiate a default verification:
  ```java
  verifyClient.getVerifiedUser("GB", "07000000000");
  ```
  Even if a user enters the phone number with the country code, Verify SDK determines the correctly internationalized
phone number.
5. The user tries to verify a phone number in the App:
  * If verification is started: *VerifyClientListener.onVerifyInProgress(final VerifyClient verifyClient)* is invoked.
  * If verification cannot be started: *VerifyClientListener.onError(final VerifyClient verifyClient, final com.nexmo.sdk.verify.event.VerifyError errorCode)* is invoked to describe the error.
6. Supply the PIN code entered by the user to the *VerifyClient* instance in your App:
  ```java
  verifyClient.checkPinCode("1234");
  ```
7. The *VerifyClientListener.onUserVerified(final VerifyClient verifyClient)* event is invoked when verification is successful.


##GCM push integration<a name="gcm"></a>

In order to configure you Nexmo application for Google Cloud Messaging (GCM):

1. Obtain an API key from Google Developer Console.
2. Provide Nexmo with your server API key. We need this to send push messages to your App. You set this value in Nexmo Manager.
  **Note** This feature is not enabled yet in the Nexmo Dashboard, please contact productfeedback@nexmo.com to configure this.
3. Enable GCM in your App: https://developers.google.com/mobile/add.
4. Provide your GCM registration token to the NexmoClient: https://developers.google.com/cloud-messaging/android/client.
5. Make sure your App handles the refresh tokens and updates *nexmoClient*.
  ```java
  nexmoClient.setGcmRegistrationToken("MyGCMRegistrationToken");
  ```

All push messages have a short lifespan. For example, if a *check* function is not invoked in time, the standard SMS-TTS flow is initiated.

Push is only available once you have verified yourself at least once on the mobile device.

*Note*: never store sensitive user details like the phone number locally. Persisting user information in local storage is not good user security.
